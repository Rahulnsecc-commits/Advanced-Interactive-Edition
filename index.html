<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GenAI Solution Architect - Advanced Study Guide</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #76b900; --secondary: #1a1a1a; --accent: #00a8e0; --bg-dark: #0f0f0f;
            --bg-card: #1a1a1a; --text-light: #e0e0e0; --text-muted: #888; --border: #333;
            --success: #4caf50; --warning: #ff9800; --danger: #f44336;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
            color: var(--text-light); line-height: 1.6;
        }
        .container { display: flex; height: 100vh; overflow: hidden; }
        .sidebar {
            width: 320px; background: var(--bg-card); border-right: 1px solid var(--border);
            overflow-y: auto; transition: transform 0.3s ease;
        }
        .sidebar-header {
            padding: 20px; background: linear-gradient(135deg, var(--primary) 0%, #5a8f00 100%);
            position: sticky; top: 0; z-index: 10;
        }
        .sidebar-header h1 { font-size: 1.3rem; margin-bottom: 5px; color: white; }
        .sidebar-header p { font-size: 0.85rem; opacity: 0.9; color: white; }

        /* Sidebar header: editable + user switch */
        .sidebar-header-top { display:flex; justify-content:space-between; align-items:flex-start; gap:12px; }
        .brand { flex:1; min-width:0; }
        #homeTitle, #homeSubtitle { outline:none; border-radius:6px; padding:4px 6px; }
        #homeTitle[contenteditable="true"]:focus, #homeSubtitle[contenteditable="true"]:focus {
            background: rgba(255,255,255,0.15);
            box-shadow: 0 0 0 3px rgba(0,0,0,0.15) inset;
        }
        .tiny-hint { font-size:0.72rem; opacity:0.85; color:rgba(255,255,255,0.9); margin-top:6px; }
        .user-menu { display:flex; align-items:center; }
        .user-btn {
            background: rgba(0,0,0,0.25);
            border: 1px solid rgba(255,255,255,0.25);
            color: white;
            padding: 8px 10px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            font-size: 0.85rem;
            display:flex; align-items:center; gap:8px;
            transition: transform 0.15s ease, background 0.2s ease, border-color 0.2s ease;
            white-space:nowrap;
        }
        .user-btn:hover { background: rgba(0,0,0,0.35); border-color: rgba(255,255,255,0.35); transform: translateY(-1px); }

        /* Modal polish + animation */
        .modal { backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }
        .modal.active .modal-content { animation: popIn 0.18s ease-out; }
        @keyframes popIn { from { transform: translateY(14px) scale(0.98); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }
        .modal-content { border: 1px solid rgba(255,255,255,0.06); }
        .modal-content-narrow { max-width: 540px; }

        /* Fullscreen modal (Handwriting) */
        .modal.fullscreen { background-color: rgba(0,0,0,0.92); }
        .modal.fullscreen .modal-content {
            width: 100%;
            height: 100%;
            max-width: none;
            max-height: none;
            border-radius: 0;
            padding: 18px;
        }

        /* User list */
        .user-list { display:flex; flex-wrap:wrap; gap:10px; }
        .user-pill {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            padding: 10px 12px;
            border-radius: 12px;
            font-weight: 700;
        }
        .user-chip {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            color: var(--text-light);
            padding: 10px 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 700;
        }
        .user-chip:hover { border-color: var(--primary); box-shadow: 0 6px 18px rgba(118,185,0,0.18); transform: translateY(-1px); }
        .user-chip.active { border-color: var(--primary); color: var(--primary); }
        .user-create-row { display:flex; gap:10px; align-items:center; }
        .user-create-row input { flex:1; }

        /* Handwritten preview resize */
        .hw-preview-wrap { background:#fff; border-radius:8px; padding:12px; display:inline-block; max-width:100%; }
        .hw-preview-wrap img { width:100%; height:auto; display:block; border-radius:6px; cursor: zoom-in; }
        .hw-resize { display:flex; align-items:center; gap:10px; margin-top:10px; color: var(--text-muted); }
        .hw-resize input[type="range"] { flex:1; }

        .search-box { padding: 15px; border-bottom: 1px solid var(--border); }
        .search-box input {
            width: 100%; padding: 10px 15px; background: var(--bg-dark); border: 1px solid var(--border);
            border-radius: 8px; color: var(--text-light); font-size: 0.9rem;
        }
        .search-box input:focus { outline: none; border-color: var(--primary); }
        .topic-category { margin: 10px 0; }
        .category-header {
            padding: 12px 20px; background: var(--bg-dark); font-weight: 600; font-size: 0.85rem;
            color: var(--primary); text-transform: uppercase; letter-spacing: 0.5px; cursor: pointer;
            display: flex; justify-content: space-between; align-items: center;
        }
        .category-header:hover { background: #1f1f1f; }
        .category-actions { display: flex; gap: 5px; }
        .category-actions button {
            background: transparent; border: none; color: var(--text-light); cursor: pointer;
            padding: 5px; border-radius: 4px; font-size: 0.9rem;
        }
        .category-actions button:hover { background: rgba(255, 255, 255, 0.1); }
        .category-items { display: none; }
        .category-items.active { display: block; }
        .topic-item {
            padding: 12px 20px; cursor: pointer; transition: all 0.2s; border-left: 3px solid transparent;
            display: flex; justify-content: space-between; align-items: center;
        }
        .topic-item:hover { background: var(--bg-dark); border-left-color: var(--primary); }
        .topic-item.active { background: var(--bg-dark); border-left-color: var(--primary); color: var(--primary); }
        .topic-item-content { flex: 1; display: flex; align-items: center; gap: 10px; }
        .topic-item-actions { display: flex; gap: 5px; opacity: 0; transition: opacity 0.2s; }
        .topic-item:hover .topic-item-actions { opacity: 1; }
        .topic-item-actions button {
            background: transparent; border: none; color: var(--text-muted); cursor: pointer;
            padding: 5px; border-radius: 4px; font-size: 0.85rem;
        }
        .topic-item-actions button:hover { color: var(--text-light); background: rgba(255, 255, 255, 0.1); }
        .topic-item .progress-indicator {
            width: 20px; height: 20px; border-radius: 50%; background: var(--bg-dark); border: 2px solid var(--border);
            display: flex; align-items: center; justify-content: center; font-size: 0.7rem;
        }
        .topic-item.completed .progress-indicator {
            background: var(--success); border-color: var(--success); color: white;
        }
        .main-content { flex: 1; overflow-y: auto; padding: 40px; }
        .content-header {
            margin-bottom: 30px; display: flex; justify-content: space-between; align-items: flex-start;
            flex-wrap: wrap; gap: 20px;
        }
        .content-title { flex: 1; }
        .content-title h2 { font-size: 2rem; margin-bottom: 10px; color: var(--primary); }
        .content-meta { display: flex; gap: 20px; margin-top: 10px; flex-wrap: wrap; }
        .meta-tag {
            background: var(--bg-card); padding: 5px 12px; border-radius: 20px;
            font-size: 0.85rem; border: 1px solid var(--border);
        }
        .action-buttons { display: flex; gap: 10px; flex-wrap: wrap; }
        .btn {
            padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9rem;
            transition: all 0.2s; display: flex; align-items: center; gap: 8px;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #5a8f00; transform: translateY(-2px); }
        .btn-secondary {
            background: var(--bg-card); color: var(--text-light); border: 1px solid var(--border);
        }
        .btn-secondary:hover { background: var(--bg-dark); }
        .btn-linkedin { background: #0077b5; color: white; }
        .btn-linkedin:hover { background: #006399; transform: translateY(-2px); }
        .btn-danger { background: var(--danger); color: white; }
        .btn-danger:hover { background: #d32f2f; }
        
        /* Content Sections */
        .content-section {
            background: var(--bg-card); border-radius: 12px; padding: 25px; margin-bottom: 25px;
            border: 1px solid var(--border); position: relative;
        }
        .section-header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;
            padding-bottom: 15px; border-bottom: 2px solid var(--border);
        }
        .section-title {
            font-size: 1.3rem; color: var(--primary);
            display: flex; align-items: center; gap: 10px; margin: 0;
        }
        .section-actions {
            display: flex; gap: 8px;
        }
        .icon-btn {
            background: var(--bg-dark); border: 1px solid var(--border); color: var(--text-light);
            padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85rem;
            transition: all 0.2s; display: flex; align-items: center; gap: 5px;
        }
        .icon-btn:hover { background: var(--bg-dark); border-color: var(--primary); color: var(--primary); }
        
        /* Key Points */
        .key-point {
            background: var(--bg-dark); padding: 20px; margin: 15px 0; border-radius: 8px;
            border-left: 4px solid var(--accent); position: relative;
            transition: all 0.3s;
        }
        .key-point:hover {
            box-shadow: 0 4px 20px rgba(0, 168, 224, 0.2);
        }
        .key-point.editing {
            border: 2px solid var(--primary);
            box-shadow: 0 0 30px rgba(118, 185, 0, 0.4);
            background: rgba(118, 185, 0, 0.05);
        }
        .key-point-header {
            display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;
        }
        .key-point-title { 
            font-weight: 600; color: var(--accent); font-size: 1.1rem; 
            flex: 1; outline: none; padding: 5px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        .key-point-title:hover {
            background: rgba(0, 168, 224, 0.1);
        }
        .key-point-title[contenteditable="true"]:focus {
            border: 2px dashed var(--primary);
            background: rgba(118, 185, 0, 0.1);
            padding: 8px;
        }
        .key-point-content { 
            color: var(--text-light); line-height: 1.8; outline: none;
            padding: 10px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        .key-point-content:hover {
            background: rgba(255, 255, 255, 0.02);
        }
        .key-point-content[contenteditable="true"]:focus {
            border: 2px dashed var(--primary);
            background: rgba(118, 185, 0, 0.1);
            padding: 15px;
            min-height: 100px;
        }
        .key-point-actions {
            display: flex; gap: 5px; opacity: 0; transition: opacity 0.2s;
        }
        .key-point:hover .key-point-actions { opacity: 1; }
        
        /* Formatting Toolbar inside Key Points */
        .formatting-toolbar {
            display: none; /* Hidden by default, shown when editing */
            gap: 8px; margin: 15px 0; flex-wrap: wrap;
            padding: 12px; background: var(--bg-dark); border-radius: 8px;
            border: 2px solid var(--primary);
            animation: slideDown 0.3s ease;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .toolbar-group {
            display: flex; gap: 5px; padding: 5px;
            border-right: 1px solid var(--border);
        }
        .toolbar-group:last-child {
            border-right: none;
        }
        .toolbar-btn {
            background: var(--bg-card); border: 1px solid var(--border); 
            color: var(--text-light); padding: 6px 10px; border-radius: 6px; 
            cursor: pointer; font-size: 0.85rem; transition: all 0.2s;
            display: flex; align-items: center; gap: 5px;
        }
        .toolbar-btn:hover { 
            background: var(--bg-dark); 
            border-color: var(--primary); 
            color: var(--primary);
            transform: translateY(-1px);
        }
        .toolbar-select {
            background: var(--bg-card); border: 1px solid var(--border);
            color: var(--text-light); padding: 6px 10px; border-radius: 6px;
            cursor: pointer; font-size: 0.8rem; transition: all 0.2s;
        }
        .toolbar-select:hover {
            border-color: var(--primary);
        }
        .toolbar-select:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .edit-btn, .delete-btn, .save-btn, .cancel-btn {
            background: transparent; border: none; color: var(--text-muted);
            cursor: pointer; padding: 6px 10px; border-radius: 4px; font-size: 0.85rem;
            transition: all 0.2s;
        }
        .edit-btn:hover { color: var(--accent); background: rgba(0, 168, 224, 0.15); }
        .delete-btn:hover { color: var(--danger); background: rgba(244, 67, 54, 0.15); }
        .save-btn { color: var(--success); font-weight: 600; }
        .save-btn:hover { background: rgba(76, 175, 80, 0.15); }
        .cancel-btn:hover { color: var(--text-light); background: rgba(255, 255, 255, 0.1); }
        
        /* Examples */
        .example-box {
            background: linear-gradient(135deg, rgba(0, 168, 224, 0.1), rgba(118, 185, 0, 0.1));
            border: 1px solid var(--accent); border-radius: 8px; padding: 20px; margin: 15px 0;
            position: relative; transition: all 0.3s;
        }
        .example-box:hover {
            box-shadow: 0 4px 20px rgba(0, 168, 224, 0.2);
        }
        .example-box.editing {
            border: 2px solid var(--primary);
            box-shadow: 0 0 30px rgba(118, 185, 0, 0.4);
        }
        .example-title {
            font-weight: 600; color: var(--accent); margin-bottom: 12px;
            display: flex; align-items: center; gap: 8px; justify-content: space-between;
            font-size: 1rem;
        }
        .example-content {
            outline: none; padding: 10px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        .example-content:hover {
            background: rgba(255, 255, 255, 0.03);
        }
        .example-content[contenteditable="true"]:focus {
            border: 2px dashed var(--primary);
            background: rgba(118, 185, 0, 0.1);
            padding: 15px;
            min-height: 80px;
        }
        
        /* Warnings */
        .warning-box {
            background: rgba(255, 152, 0, 0.1); border: 1px solid var(--warning);
            border-left: 4px solid var(--warning); border-radius: 8px; padding: 20px; margin: 15px 0;
            position: relative; transition: all 0.3s;
        }
        .warning-box:hover {
            box-shadow: 0 4px 20px rgba(255, 152, 0, 0.2);
        }
        .warning-box.editing {
            border: 2px solid var(--primary);
            box-shadow: 0 0 30px rgba(118, 185, 0, 0.4);
        }
        .warning-title { 
            font-weight: 600; color: var(--warning); margin-bottom: 12px; 
            display: flex; justify-content: space-between; align-items: center;
            font-size: 1rem;
        }
        .warning-content {
            outline: none; padding: 10px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        .warning-content:hover {
            background: rgba(255, 255, 255, 0.03);
        }
        .warning-content[contenteditable="true"]:focus {
            border: 2px dashed var(--primary);
            background: rgba(118, 185, 0, 0.1);
            padding: 15px;
            min-height: 80px;
        }
        
        /* Add Item Button */
        .add-item-btn {
            width: 100%; padding: 15px; background: var(--bg-dark); 
            border: 2px dashed var(--border); color: var(--text-muted);
            border-radius: 8px; cursor: pointer; font-size: 0.95rem; 
            margin-top: 15px; transition: all 0.3s;
            display: flex; align-items: center; justify-content: center;
            gap: 8px; font-weight: 600;
        }
        .add-item-btn:hover { 
            border-color: var(--primary); 
            color: var(--primary); 
            background: rgba(118, 185, 0, 0.08);
            transform: translateY(-2px);
        }
        
        /* Progress Bar */
        .progress-bar {
            height: 8px; background: var(--bg-dark); border-radius: 10px; overflow: hidden; margin: 20px 0;
        }
        .progress-fill {
            height: 100%; background: linear-gradient(90deg, var(--primary), var(--accent));
            transition: width 0.5s ease;
        }
        
        /* Modal */
        .modal {
            display: none; position: fixed; z-index: 3000; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.85); align-items: center; justify-content: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: var(--bg-card); padding: 30px; border-radius: 12px; max-width: 700px;
            width: 90%; max-height: 90vh; overflow-y: auto; border: 1px solid var(--border);
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
        }
        .modal-header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;
            padding-bottom: 15px; border-bottom: 2px solid var(--border);
        }
        .modal-title { font-size: 1.5rem; color: var(--primary); }
        .close-btn {
            background: transparent; border: none; color: var(--text-light); font-size: 1.8rem;
            cursor: pointer; padding: 5px; transition: all 0.2s;
        }
        .close-btn:hover { color: var(--danger); transform: rotate(90deg); }
        
        /* Form Elements */
        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block; margin-bottom: 8px; color: var(--text-light); font-weight: 600;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%; padding: 12px; background: var(--bg-dark); border: 1px solid var(--border);
            border-radius: 8px; color: var(--text-light); font-size: 0.9rem;
            font-family: inherit;
        }
        .form-group textarea { min-height: 150px; resize: vertical; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none; border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(118, 185, 0, 0.1);
        }
        .form-actions {
            display: flex; gap: 10px; justify-content: flex-end; margin-top: 25px;
        }
        
        /* LinkedIn Preview */
        .linkedin-preview {
            background: var(--bg-dark); border: 1px solid var(--border);
            border-radius: 8px; padding: 25px; margin-top: 20px;
        }
        .linkedin-preview-header {
            display: flex; align-items: center; gap: 12px; margin-bottom: 20px;
            padding-bottom: 15px; border-bottom: 1px solid var(--border);
        }
        .linkedin-avatar {
            width: 52px; height: 52px; border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex; align-items: center;
            justify-content: center; font-size: 1.8rem;
        }
        .linkedin-user-info {
            flex: 1;
        }
        .linkedin-user-name {
            font-weight: 700; font-size: 1rem; margin-bottom: 3px;
        }
        .linkedin-user-title {
            font-size: 0.85rem; color: var(--text-muted);
        }
        .linkedin-post-content {
            color: var(--text-light); white-space: pre-wrap;
            line-height: 1.7; margin: 15px 0; font-size: 0.95rem;
        }
        .hashtags {
            color: var(--accent); margin-top: 15px; font-weight: 500;
        }
        
        /* Saved Indicator */
        .saved-indicator {
            position: fixed; bottom: 30px; right: 30px; background: var(--success);
            color: white; padding: 15px 25px; border-radius: 8px; font-weight: 600;
            opacity: 0; transition: opacity 0.3s; z-index: 4000;
            box-shadow: 0 4px 20px rgba(76, 175, 80, 0.4);
            display: flex; align-items: center; gap: 10px;
        }
        .saved-indicator.show { opacity: 1; }
        
        /* Add Category Button */
        .add-category-btn {
            width: 100%; padding: 12px; background: var(--primary); color: white; border: none;
            border-radius: 8px; cursor: pointer; font-size: 0.9rem; margin: 10px 0; transition: all 0.2s;
            font-weight: 600;
        }
        .add-category-btn:hover { background: #5a8f00; transform: translateY(-2px); }
        
        /* Content Formatting Styles */
        .key-point-content img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 10px 0;
            display: block;
            cursor: pointer;
            position: relative;
        }
        .key-point-content img:hover {
            opacity: 0.9;
            box-shadow: 0 4px 15px rgba(0, 168, 224, 0.3);
        }
        .image-wrapper {
            position: relative;
            display: inline-block;
            margin: 10px 0;
        }
        .image-caption {
            display: block;
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-muted);
            font-style: italic;
            margin-top: 5px;
        }
        .key-point-content a {
            color: var(--accent);
            text-decoration: underline;
        }
        .key-point-content a:hover {
            color: var(--primary);
        }
        
        /* Image Editor Modal */
        .image-editor-container {
            margin: 20px 0;
        }
        .image-editor-toolbar {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            padding: 15px;
            background: var(--bg-dark);
            border-radius: 8px;
            margin-bottom: 20px;
            align-items: center;
        }
        .toolbar-label {
            font-weight: 600;
            margin-right: 8px;
            color: var(--text-light);
        }
        .image-editor-toolbar input[type="range"] {
            width: 150px;
        }
        .image-editor-toolbar input[type="color"] {
            width: 40px;
            height: 40px;
            border: 2px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
        }
        .image-editor-preview {
            background: var(--bg-dark);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .canvas-container {
            position: relative;
            display: inline-block;
        }
        #editingImage {
            border-radius: 8px;
            transition: all 0.3s;
        }
        #drawingCanvas {
            cursor: crosshair;
            border: 2px dashed var(--primary);
        }
        
        /* Drag and Drop Styles */
        .draggable {
            cursor: move;
            transition: all 0.2s;
            position: relative;
        }
        .draggable:hover {
            background: rgba(118, 185, 0, 0.05);
        }
        .draggable.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }
        .drag-handle {
            position: absolute;
            left: -30px;
            top: 50%;
            transform: translateY(-50%);
            cursor: move;
            color: var(--text-muted);
            font-size: 1.5rem;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .draggable:hover .drag-handle {
            opacity: 1;
        }
        .drop-indicator {
            height: 4px;
            background: var(--primary);
            border-radius: 2px;
            margin: 5px 0;
            display: none;
        }
        .drop-indicator.active {
            display: block;
            animation: pulse 0.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Note Attachments */
        .note-attachment {
            margin: 15px 0;
        }
        .attachment-card {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px 15px;
            transition: all 0.2s;
        }
        .attachment-card:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 15px rgba(118, 185, 0, 0.2);
        }
        .attachment-icon {
            font-size: 2rem;
        }
        .attachment-info {
            flex: 1;
        }
        .attachment-name {
            font-weight: 600;
            color: var(--text-light);
            margin-bottom: 3px;
        }
        .attachment-size {
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        .attachment-download, .attachment-remove {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            font-size: 1.2rem;
            transition: all 0.2s;
        }
        .attachment-download:hover {
            color: var(--accent);
            background: rgba(0, 168, 224, 0.1);
        }
        .attachment-remove:hover {
            color: var(--danger);
            background: rgba(244, 67, 54, 0.1);
        }
        
        /* YouTube Embed */
        .youtube-embed {
            margin: 20px 0;
        }
        .youtube-container {
            position: relative;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
        }
        .youtube-container iframe {
            width: 100%;
            height: 300px;
            border-radius: 8px;
        }
        .youtube-remove {
            margin-top: 10px;
            background: var(--danger);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        .youtube-remove:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }
        
        /* Handwriting Pad */
        .handwriting-container {
            margin: 20px 0;
        }
        .handwriting-toolbar {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            padding: 15px;
            background: var(--bg-dark);
            border-radius: 8px;
            margin-bottom: 20px;
            align-items: center;
        }
        .handwriting-canvas-container {
            background: #ffffff;
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        #handwritingCanvas {
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: crosshair;
            touch-action: none;
            background: #ffffff;
            max-width: 100%;
            /* Prevent text selection and improve pen tablet support */
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            /* Ensure proper touch/pen handling */
            -webkit-touch-callout: none;
        }
        
        /* Custom cursor when drawing */
        #handwritingCanvas.drawing {
            cursor: none;
        }
        
        /* Pen cursor indicator */
        .pen-cursor {
            position: fixed;
            pointer-events: none;
            border-radius: 50%;
            border: 2px solid rgba(0,0,0,0.5);
            transform: translate(-50%, -50%);
            z-index: 9999;
            display: none;
        }
        
        /* Handwritten Notes Display */
        .handwritten-note {
            background: var(--bg-dark);
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
            position: relative;
            transition: all 0.3s;
        }
        .handwritten-note:hover {
            box-shadow: 0 4px 20px rgba(118, 185, 0, 0.2);
        }
        .handwritten-note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .handwritten-note-title {
            font-weight: 600;
            color: var(--primary);
            font-size: 1.1rem;
        }
        .handwritten-note-actions {
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .handwritten-note:hover .handwritten-note-actions {
            opacity: 1;
        }
        .handwritten-note-preview {
            background: #ffffff;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .handwritten-note-preview img {
            max-width: 100%;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .handwritten-note-caption {
            text-align: center;
            font-style: italic;
            color: var(--text-muted);
            margin-top: 10px;
        }
        
        @media (max-width: 768px) {
            margin: 15px 0;
        }
        .attachment-card {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px 15px;
            transition: all 0.2s;
        }
        .attachment-card:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 15px rgba(118, 185, 0, 0.2);
        }
        .attachment-icon {
            font-size: 2rem;
        }
        .attachment-info {
            flex: 1;
        }
        .attachment-name {
            font-weight: 600;
            color: var(--text-light);
            margin-bottom: 3px;
        }
        .attachment-size {
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        .attachment-download, .attachment-remove {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            font-size: 1.2rem;
            transition: all 0.2s;
        }
        .attachment-download:hover {
            color: var(--accent);
            background: rgba(0, 168, 224, 0.1);
        }
        .attachment-remove:hover {
            color: var(--danger);
            background: rgba(244, 67, 54, 0.1);
        }
        
        /* YouTube Embed */
        .youtube-embed {
            margin: 20px 0;
        }
        .youtube-container {
            position: relative;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
        }
        .youtube-container iframe {
            width: 100%;
            height: 400px;
            border-radius: 8px;
        }
        .youtube-remove {
            margin-top: 10px;
            background: var(--danger);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        .youtube-remove:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }
        
        @media (max-width: 768px) {
            .container { flex-direction: column; }
            .sidebar { width: 100%; height: auto; max-height: 50vh; }
            .main-content { padding: 20px; }
            .content-title h2 { font-size: 1.5rem; }
            .action-buttons { width: 100%; }
            .btn { width: 100%; justify-content: center; }
            .formatting-toolbar {
                flex-direction: column;
            }
            .toolbar-group {
                border-right: none;
                border-bottom: 1px solid var(--border);
                padding-bottom: 10px;
            }
            .toolbar-group:last-child {
                border-bottom: none;
            }
            .youtube-container iframe {
                height: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-header-top">
                    <div class="brand">
                        <h1 id="homeTitle" contenteditable="true" spellcheck="false">üìö GenAI Study Guide</h1>
                        <p id="homeSubtitle" contenteditable="true" spellcheck="false">Advanced Interactive Edition</p>
                        <div class="tiny-hint">Click title/subtitle to edit ‚Ä¢ Saved per user</div>
                    </div>
                    <div class="user-menu">
                        <button class="user-btn" onclick="openUserModal()">üë§ <span id="currentUserLabel">Default</span></button>
                    </div>
                </div>
            </div>
            <div class="search-box">
                <input type="text" placeholder="üîç Search topics..." oninput="handleSearch(event)">
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <button class="add-category-btn" onclick="showAddCategoryModal()">‚ûï Add New Category</button>
            <div id="topicsList"></div>
        </div>
        <div class="main-content" id="mainContent">
            <div id="contentArea">
                <div class="content-header">
                    <div class="content-title">
                        <h2>üéØ Welcome to Advanced Study Guide</h2>
                        <p style="color: var(--text-muted); margin-top: 10px; font-size: 1.05rem;">
                            Select a topic to begin. Click on any section to edit directly!<br>
                            <span style="color: var(--accent); font-size: 0.9rem;">‚ú® All edits are saved automatically to the page.</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- LinkedIn Post Modal -->
    <div class="modal" id="linkedinModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üì± Create LinkedIn Post</h2>
                <button class="close-btn" onclick="closeLinkedInModal()">&times;</button>
            </div>
            <div class="form-group">
                <label>üìù Post Content</label>
                <textarea id="linkedinContent" rows="12"></textarea>
                <small style="color: var(--text-muted); display: block; margin-top: 8px;">
                    ‚úèÔ∏è Customize your post before sharing. The content below shows how it will appear on LinkedIn.
                </small>
            </div>
            <div class="linkedin-preview">
                <div class="linkedin-preview-header">
                    <div class="linkedin-avatar">üë§</div>
                    <div class="linkedin-user-info">
                        <div class="linkedin-user-name">Your Name</div>
                        <div class="linkedin-user-title">GenAI Solution Architect</div>
                    </div>
                </div>
                <div class="linkedin-post-content" id="linkedinPreview"></div>
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closeLinkedInModal()">Cancel</button>
                <button class="btn btn-linkedin" onclick="copyLinkedInPost()">üìã Copy to Clipboard</button>
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div class="modal" id="categoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="categoryModalTitle">Add New Category</h2>
                <button class="close-btn" onclick="closeCategoryModal()">&times;</button>
            </div>
            <form id="categoryForm" onsubmit="saveCategoryForm(event)">
                <div class="form-group">
                    <label>Category Name *</label>
                    <input type="text" id="categoryName" required>
                </div>
                <div class="form-group">
                    <label>Icon (emoji)</label>
                    <input type="text" id="categoryIcon" maxlength="2" placeholder="e.g., üìö">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeCategoryModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Category</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Topic Modal -->
    <div class="modal" id="topicModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="topicModalTitle">Add New Topic</h2>
                <button class="close-btn" onclick="closeTopicModal()">&times;</button>
            </div>
            <form id="topicForm" onsubmit="saveTopicForm(event)">
                <input type="hidden" id="topicCategory">
                <input type="hidden" id="topicId">
                <div class="form-group">
                    <label>Topic Name *</label>
                    <input type="text" id="topicName" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="topicDescription"></textarea>
                </div>
                <div class="form-group">
                    <label>Time Estimate</label>
                    <input type="text" id="topicTime" placeholder="e.g., 30 min">
                </div>
                <div class="form-group">
                    <label>Difficulty</label>
                    <select id="topicDifficulty">
                        <option value="Beginner">Beginner</option>
                        <option value="Intermediate">Intermediate</option>
                        <option value="Advanced">Advanced</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeTopicModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Topic</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Image Editor Modal -->
    <div class="modal" id="imageEditorModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title">üñºÔ∏è Edit Image</h2>
                <button class="close-btn" onclick="closeImageEditor()">&times;</button>
            </div>
            <div class="image-editor-container">
                <div class="image-editor-toolbar">
                    <div class="toolbar-group">
                        <label class="toolbar-label">Width:</label>
                        <input type="range" id="imgWidth" min="100" max="800" value="400" oninput="updateImageSize()">
                        <span id="widthValue">400px</span>
                    </div>
                    <div class="toolbar-group">
                        <label class="toolbar-label">Rotate:</label>
                        <button class="toolbar-btn" onclick="rotateImage(-90)">‚Ü∂ -90¬∞</button>
                        <button class="toolbar-btn" onclick="rotateImage(90)">‚Ü∑ +90¬∞</button>
                        <button class="toolbar-btn" onclick="rotateImage(180)">‚Üª 180¬∞</button>
                    </div>
                    <div class="toolbar-group">
                        <button class="toolbar-btn" onclick="startDrawing()" id="drawBtn">‚úèÔ∏è Draw</button>
                        <button class="toolbar-btn" onclick="clearDrawing()" id="clearDrawBtn" style="display:none;">üóëÔ∏è Clear Drawing</button>
                        <input type="color" id="drawColor" value="#ff0000" title="Drawing Color">
                        <input type="range" id="drawSize" min="1" max="10" value="3" title="Brush Size">
                    </div>
                </div>
                <div class="image-editor-preview">
                    <div class="canvas-container" id="canvasContainer">
                        <img id="editingImage" src="" style="max-width: 100%;">
                        <canvas id="drawingCanvas" style="display:none; position:absolute; top:0; left:0;"></canvas>
                    </div>
                </div>
                <div class="form-group">
                    <label>üìù Caption (optional)</label>
                    <input type="text" id="imageCaption" placeholder="Add a caption for this image...">
                </div>
            </div>
            <div class="form-actions">
                <button class="btn btn-danger" onclick="deleteEditingImage()">üóëÔ∏è Delete Image</button>
                <button class="btn btn-secondary" onclick="closeImageEditor()">Cancel</button>
                <button class="btn btn-primary" onclick="saveImageEdits()">üíæ Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Handwriting Pad Modal -->
    <div class="modal" id="handwritingPadModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title">‚úçÔ∏è Handwriting Pad</h2>
                <div style="display:flex; gap:10px; align-items:center;">
                    <button class="icon-btn" onclick="toggleHandwritingFullscreen()" title="Fullscreen">üñ•Ô∏è Fullscreen</button>
                    <button class="close-btn" onclick="closeHandwritingPad()">&times;</button>
                </div>
            </div>
            <div class="handwriting-container">
                <div class="handwriting-toolbar">
                    <div class="toolbar-group">
                        <label class="toolbar-label">Pen Color:</label>
                        <input type="color" id="penColor" value="#000000">
                    </div>
                    <div class="toolbar-group">
                        <label class="toolbar-label">Pen Size:</label>
                        <input type="range" id="penSize" min="1" max="30" value="3">
                        <span id="penSizeValue" style="min-width: 40px;">3px</span>
                        <div id="penSizePreview" style="width: 30px; height: 30px; border-radius: 50%; background: #000; display: flex; align-items: center; justify-content: center; border: 2px solid var(--border);">
                            <div id="penDot" style="width: 3px; height: 3px; border-radius: 50%; background: white;"></div>
                        </div>
                    </div>
                    <div class="toolbar-group">
                        <button class="toolbar-btn" onclick="setPenSize(1)">Fine</button>
                        <button class="toolbar-btn" onclick="setPenSize(5)">Medium</button>
                        <button class="toolbar-btn" onclick="setPenSize(12)">Thick</button>
                        <button class="toolbar-btn" onclick="setPenSize(20)">Bold</button>
                    </div>
                    <div class="toolbar-group">
                        <button class="toolbar-btn" onclick="document.getElementById('penColor').value='#000000'; updatePenPreview();">‚ö´ Black</button>
                        <button class="toolbar-btn" onclick="document.getElementById('penColor').value='#0000ff'; updatePenPreview();">üîµ Blue</button>
                        <button class="toolbar-btn" onclick="document.getElementById('penColor').value='#ff0000'; updatePenPreview();">üî¥ Red</button>
                        <button class="toolbar-btn" onclick="document.getElementById('penColor').value='#00ff00'; updatePenPreview();">üü¢ Green</button>
                    </div>
                    <div class="toolbar-group">
                        <button class="toolbar-btn" onclick="pasteImageToCanvas()">üìã Paste</button>
                        <button class="toolbar-btn" id="eraserBtn" onclick="toggleEraser()">üßπ Eraser</button>
                        <button class="toolbar-btn" onclick="clearHandwritingCanvas()">üóëÔ∏è Clear All</button>
                    </div>
                </div>
                <div class="handwriting-canvas-container">
                    <canvas id="handwritingCanvas" width="800" height="600"></canvas>
                </div>
                <div class="form-group">
                    <label>üìå Title</label>
                    <input type="text" id="handwritingTitle" placeholder="Give your handwritten note a title...">
                </div>
                <div class="form-group">
                    <label>üìù Caption (optional)</label>
                    <input type="text" id="handwritingCaption" placeholder="Add a caption or description...">
                </div>
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closeHandwritingPad()">Cancel</button>
                <button class="btn btn-primary" onclick="saveHandwritingNote()">üíæ Save Note</button>
            </div>
        </div>
    </div>

    <div class="saved-indicator" id="savedIndicator">
        <span>‚úì</span>
        <span>Saved Successfully!</span>
    </div>

    <script src="data-latest.js"></script>
    <script src="app-advanced.js"></script>
    <script>
        // Update pen size display and preview
        function updatePenPreview() {
            const size = document.getElementById('penSize').value;
            const color = document.getElementById('penColor').value;
            document.getElementById('penSizeValue').textContent = size + 'px';
            const penDot = document.getElementById('penDot');
            if (penDot) {
                penDot.style.width = Math.min(size, 25) + 'px';
                penDot.style.height = Math.min(size, 25) + 'px';
                penDot.style.background = color;
            }
        }
        
        // Set pen size programmatically
        function setPenSize(size) {
            document.getElementById('penSize').value = size;
            updatePenPreview();
        }
        
        // Event listeners for pen controls
        document.getElementById('penSize').addEventListener('input', updatePenPreview);
        document.getElementById('penColor').addEventListener('input', updatePenPreview);
        
        // Initialize preview on page load
        document.addEventListener('DOMContentLoaded', function() {
            updatePenPreview();
        });
    </script>

    <!-- User Modal -->
    <div class="modal" id="userModal">
        <div class="modal-content modal-content-narrow">
            <div class="modal-header">
                <h3 class="modal-title">üë§ Your Home Page</h3>
                <button class="close-btn" onclick="closeUserModal()">&times;</button>
            </div>

            <div class="form-group">
                <label>Current user</label>
                <div class="user-pill" id="userModalCurrent">Default</div>
            </div>

            <div class="form-group">
                <label>Switch user</label>
                <div id="userList" class="user-list"></div>
            </div>

            <div class="form-group">
                <label>Create new user</label>
                <div class="user-create-row">
                    <input id="newUserName" type="text" placeholder="e.g., Rahul / Mishika / Work / Interview Prep">
                    <button class="btn btn-primary" onclick="createUser()">Create</button>
                </div>
                <p class="tiny-hint" style="margin-top:10px;color:var(--text-muted);">
                    Each user has their own saved edits, notes, progress, and home title/subtitle.
                </p>
            </div>

            <div class="form-actions">
                <button class="btn btn-secondary" onclick="resetCurrentUserToDefault()">Reset this user to default</button>
                <button class="btn btn-primary" onclick="closeUserModal()">Done</button>
            </div>
        </div>
    </div>

</body>
</html>
